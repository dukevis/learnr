library(leaflet)
library(jsonlite)

#Set the name "geojson" to a geojson file located on my D drive.
geojson <- readLines("D:\\LearnR\\TryGEojson\\Triangle.geojson", warn = FALSE) %>%
  paste(collapse = "\n") %>%
  fromJSON(simplifyVector = FALSE)

#set the style properties
geojson$style = list(
  weight = 1,
  color = "#555555",
  opacity = 1,
  fillOpacity = 0.8
)

#Create and name the variable "tot_pop" and set it to the field named
#DP0010001
tot_pop <- sapply(geojson$features, function(feat){
  feat$properties$DP0010001
})

#Create and name the variable "fem_pop" and set it to the field named
#DP0010039
fem_pop <- sapply(geojson$features, function(feat){
  feat$properties$DP0010039
})

#Calculate the percentage of females
perc <- colorQuantile("Greens", fem_pop/tot_pop)

#map the geojson file with using the percentage.
geojson$features <- lapply(geojson$features, function(feat) {
  feat$properties$style <- list(
    fillColor = perc(
      feat$properties$DP0010039 / max(1, feat$properties$DP0010001)
    )
  )
  feat
})

#Add the geojson map to leaflet
leaflet() %>% addGeoJSON(geojson)

output$map <-renderLeaflet({
  leaflet(geojson)%>% addTiles() %>%
   fitBounds(~min(38), ~min(87), ~max(40), ~max(90))
})
